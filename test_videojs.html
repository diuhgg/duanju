<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Video.js 播放器测试</title>
    <!-- Video.js CSS -->
    <link href="https://vjs.zencdn.net/8.6.1/video-js.css" rel="stylesheet">
    <link rel="stylesheet" href="static/css/player.css">
    <style>
        body {
            padding: 20px;
            background: #0f0f23;
            color: white;
        }
        .test-container {
            max-width: 800px;
            margin: 0 auto;
        }
        .test-info {
            background: rgba(255, 255, 255, 0.1);
            padding: 20px;
            border-radius: 12px;
            margin-bottom: 20px;
        }
    </style>
</head>
<body>
    <div class="test-container">
        <div class="test-info">
            <h1>Video.js 播放器测试 - 响应式优化版</h1>
            <p>这是一个测试页面，用于验证Video.js播放器的响应式功能。</p>
            <p><strong>新功能测试：</strong></p>
            <ul>
                <li>✅ 响应式设计：自动适配不同屏幕尺寸</li>
                <li>✅ 智能尺寸调整：根据设备方向优化播放器大小</li>
                <li>✅ 移动端优化：横屏/竖屏不同布局</li>
                <li>✅ 自定义样式：美观的播放控制界面</li>
                <li>✅ HLS流媒体支持：原生支持m3u8格式</li>
                <li>✅ 键盘快捷键：空格键播放/暂停</li>
            </ul>
            <p><strong>当前屏幕信息：</strong></p>
            <div id="screen-info" style="font-family: monospace; background: rgba(255,255,255,0.1); padding: 10px; border-radius: 6px;">
                宽度: <span id="screen-width"></span>px | 
                高度: <span id="screen-height"></span>px | 
                方向: <span id="screen-orientation"></span>
            </div>
        </div>

        <div class="player-container">
            <video
                id="test-player"
                class="video-js vjs-default-skin"
                controls
                preload="auto"
                width="100%"
                height="450"
                data-setup='{"fluid": true, "responsive": true}'>
                <p class="vjs-no-js">
                    要观看此视频，请启用JavaScript，并考虑升级到
                    <a href="https://videojs.com/html5-video-support/" target="_blank" rel="noopener noreferrer">
                        支持HTML5视频的网络浏览器
                    </a>。
                </p>
            </video>
        </div>

        <div class="test-controls" style="margin-top: 20px;">
            <button onclick="loadTestVideo()" style="padding: 10px 20px; background: #667eea; color: white; border: none; border-radius: 6px; cursor: pointer;">
                加载测试视频
            </button>
            <button onclick="togglePlayPause()" style="padding: 10px 20px; background: #764ba2; color: white; border: none; border-radius: 6px; cursor: pointer; margin-left: 10px;">
                播放/暂停
            </button>
            <button onclick="testResize()" style="padding: 10px 20px; background: #f093fb; color: white; border: none; border-radius: 6px; cursor: pointer; margin-left: 10px;">
                测试响应式
            </button>
        </div>
    </div>

    <!-- Video.js JavaScript -->
    <script src="https://vjs.zencdn.net/8.6.1/video.min.js"></script>
    <!-- HLS支持 -->
    <script src="https://cdn.jsdelivr.net/npm/@videojs/http-streaming@3.0.2/dist/videojs-http-streaming.min.js"></script>
    
    <script>
        let testPlayer = null;

        // 初始化播放器
        function initTestPlayer() {
            if (testPlayer) {
                testPlayer.dispose();
            }
            
            testPlayer = videojs('test-player', {
                controls: true,
                fluid: true,
                responsive: true,
                playbackRates: [0.5, 1, 1.25, 1.5, 2],
                html5: {
                    hls: {
                        enableLowInitialPlaylist: true,
                        smoothQualityChange: true,
                        overrideNative: true
                    }
                },
                techOrder: ['html5'],
                sources: []
            });

            testPlayer.ready(() => {
                console.log('测试播放器已准备就绪');
            });

            testPlayer.on('error', (error) => {
                console.error('播放器错误:', error);
            });

            return testPlayer;
        }

        // 加载测试视频
        function loadTestVideo() {
            if (!testPlayer) {
                testPlayer = initTestPlayer();
            }
            
            // 使用一个公开的测试HLS流
            const testVideoUrl = 'https://demo.unified-streaming.com/k8s/features/stable/video/tears-of-steel/tears-of-steel.ism/.m3u8';
            
            testPlayer.src({
                src: testVideoUrl,
                type: 'application/x-mpegURL'
            });
            
            console.log('已加载测试视频:', testVideoUrl);
        }

        // 播放/暂停控制
        function togglePlayPause() {
            if (testPlayer) {
                if (testPlayer.paused()) {
                    testPlayer.play();
                } else {
                    testPlayer.pause();
                }
            }
        }

        // 键盘快捷键
        document.addEventListener('keydown', function(e) {
            if (e.key === ' ') {
                e.preventDefault();
                togglePlayPause();
            }
        });

        // 测试响应式功能
        function testResize() {
            updateScreenInfo();
            if (testPlayer) {
                testPlayer.trigger('resize');
            }
        }

        // 更新屏幕信息显示
        function updateScreenInfo() {
            document.getElementById('screen-width').textContent = window.innerWidth;
            document.getElementById('screen-height').textContent = window.innerHeight;
            document.getElementById('screen-orientation').textContent = window.innerWidth > window.innerHeight ? '横屏' : '竖屏';
        }

        // 窗口大小改变时更新信息
        window.addEventListener('resize', updateScreenInfo);

        // 页面加载完成后初始化
        document.addEventListener('DOMContentLoaded', function() {
            initTestPlayer();
            updateScreenInfo();
        });

        // 页面卸载时清理
        window.addEventListener('beforeunload', () => {
            if (testPlayer) {
                testPlayer.dispose();
            }
        });
    </script>
</body>
</html>